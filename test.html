<!DOCTYPE html>
<html>

<head>
  <title>Test img web manager</title>
</head>

<body>
  <img src="http://127.0.0.1:8080/img/config-1/test-1/acf0c97d-6ce7-4250-808c-3db6e2049cf4.jpg">
  <div>
    <input type="file" id="imageInput" accept="image/*">
    <input type="text" id="chapterIdInput" placeholder="Chapter ID">
    <button onclick="uploadImage()">Bild hochladen</button>
  </div>
</body>
<script>
  async function readFile(file) {
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = (ev) => resolve(ev.target?.result);
      reader.readAsDataURL(file);
    });
  }

  async function uploadImage() {
    const imageInput = document.getElementById('imageInput');
    const chapterIdInput = document.getElementById('chapterIdInput');

    const file = await readFile(imageInput.files[0])
    const chapterId = chapterIdInput.value;

    if (file == null || chapterId == null) {
      alert('Bitte wÃ¤hle ein Bild aus und gib eine Chapter ID ein.');
      return;
    }

    fetch('http://127.0.0.1:8080/upload', {
      method: 'POST',
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        config_id: "config1",
        chapter_id: chapterId,
        image: file,
      }),
    })
      .then(response => {
        if (!response.ok) {
          throw new Error(`Fehler beim Upload: ${response.status} - ${response.statusText}`);
        }
        return null;
      })
      .then(data => {
        console.log('Erfolgreich hochgeladen:', data);
      })
      .catch(error => {
        console.error('Fehler:', error);
      });
  }
</script>

</html>