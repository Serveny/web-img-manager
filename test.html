<!DOCTYPE html>
<html>

<head>
  <title>Test img web manager</title>
</head>

<body>
  <img src="http://127.0.0.1:8080/img/asdf">
  <input type="file" id="imageInput" accept="image/*">
  <input type="text" id="chapterIdInput" placeholder="Chapter ID">
  <button onclick="uploadImage()">Bild hochladen</button>
</body>
<script>
  async function readFile(file) {
    return new Promise((resolve) => {
      const reader = new FileReader();
      reader.onload = (ev) => resolve(ev.target?.result);
      reader.readAsDataURL(file);
    });
  }

  async function uploadImage() {
    const imageInput = document.getElementById('imageInput');
    const chapterIdInput = document.getElementById('chapterIdInput');

    const file = await readFile(imageInput.files[0])
    if (file == null) {
      console.error("File is null")
      return;
    }
    const chapterId = chapterIdInput.value;

    if (!file || !chapterId) {
      alert('Bitte wÃ¤hle ein Bild aus und gib eine Chapter ID ein.');
      return;
    }

    fetch('http://127.0.0.1:8080/upload', {
      method: 'POST',
      body: JSON.stringify({
        config_id: 'config-1',
        chapter_id: chapterId,
        image_base64: file,
      }),
      crossDomain: true,
      xhrFields: {
        withCredentials: false,
      },
    })
      .then(response => {
        if (!response.ok) {
          throw new Error(`Fehler beim Upload: ${response.status} - ${response.statusText}`);
        }
        return null;
      })
      .then(data => {
        console.log('Erfolgreich hochgeladen:', data);
      })
      .catch(error => {
        console.error('Fehler:', error);
      });
  }
</script>

</html>